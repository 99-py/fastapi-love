{% extends "base.html" %}

{% block title %}{{ memory.title }} - çºªå¿µæ—¥è¯¦æƒ…{% endblock %}

{% block extra_css %}
<style>
    /* çºªå¿µæ—¥è¯¦æƒ…ä¸“ç”¨æ ·å¼ */
    .memory-detail-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* è¿”å›æŒ‰é’® */
    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: #666;
        text-decoration: none;
        margin-bottom: 20px;
        padding: 10px 20px;
        border-radius: 10px;
        background: white;
        border: 1px solid #e0e0e0;
        transition: all 0.3s ease;
    }
    
    .back-btn:hover {
        background: #f8f9fa;
        border-color: #ff6b6b;
        color: #ff6b6b;
    }
    
    /* çºªå¿µæ—¥å¤´éƒ¨ */
    .memory-header {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        text-align: center;
        position: relative;
        overflow: hidden;
        position: relative;
    }
    /* åˆ é™¤æŒ‰é’®æ ·å¼ */
    .delete-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        background: #ff4757;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    .delete-btn:hover {
        background: #ff3742;
        box-shadow: 0 3px 10px rgba(255, 71, 87, 0.3);
    }
    
    .memory-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
    }
    
    .memory-icon {
        font-size: 3.5rem;
        margin-bottom: 15px;
    }
    
    .memory-title {
        font-size: 2.2rem;
        color: #333;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    .memory-date {
        font-size: 1.1rem;
        color: #666;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .memory-description {
        font-size: 1.1rem;
        color: #555;
        line-height: 1.7;
        max-width: 600px;
        margin: 0 auto 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    
    .stat-number {
        font-size: 2.2rem;
        font-weight: bold;
        color: #ff6b6b;
        line-height: 1;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    /* å¹´è½®è®°å½•åŒºåŸŸ */
    .snapshots-section {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }
    
    .section-title {
        font-size: 1.5rem;
        color: #333;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .snapshots-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .snapshot-item {
        padding: 20px;
        border-radius: 15px;
        background: #f8f9fa;
        position: relative;
        border-left: 4px solid #ff6b6b;
        transition: all 0.3s ease;
    }
    
    .snapshot-item:hover {
        transform: translateX(5px);
        box-shadow: 0 3px 15px rgba(0,0,0,0.08);
    }
    
    .snapshot-year {
        font-size: 1.3rem;
        font-weight: bold;
        color: #ff6b6b;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .snapshot-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: #666;
        flex-wrap: wrap;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        background: white;
        border-radius: 20px;
    }
    
    .snapshot-note {
        font-size: 1.1rem;
        line-height: 1.7;
        color: #333;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 8px;
    }
    
    .snapshot-image {
        margin-top: 15px;
    }
    
    .snapshot-image img {
        max-width: 100%;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .snapshot-image img:hover {
        transform: scale(1.02);
    }
    
    .snapshot-date {
        font-size: 0.9rem;
        color: #888;
        margin-top: 10px;
        text-align: right;
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }
    
    .empty-icon {
        font-size: 3rem;
        color: #ddd;
        margin-bottom: 15px;
    }
    
    /* æ·»åŠ å¹´è½®è®°å½•è¡¨å• */
    .add-snapshot-form {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #ff6b6b;
        box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
    }
    
    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }
    
    .btn-submit {
        padding: 12px 30px;
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
    }
    
    .btn-submit:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3);
    }
    
    .btn-submit:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* å›¾ç‰‡é¢„è§ˆ */
    .image-preview {
        margin-top: 10px;
        text-align: center;
    }
    
    .image-preview img {
        max-width: 200px;
        border-radius: 8px;
        display: none;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        .memory-detail-container {
            padding: 15px;
        }
        
        .memory-header {
            padding: 20px;
        }
        
        .memory-title {
            font-size: 1.8rem;
        }
        
        .memory-icon {
            font-size: 2.5rem;
        }
        
        .stats-cards {
            grid-template-columns: 1fr;
        }
        
        .form-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="memory-detail-container">
    <!-- è¿”å›æŒ‰é’® -->
    <a href="/memories" class="back-btn">
        <i class="fas fa-arrow-left"></i> è¿”å›çºªå¿µæ—¥åˆ—è¡¨
    </a>

    <!-- çºªå¿µæ—¥å¤´éƒ¨ä¿¡æ¯ -->
    <div class="memory-header">
        <!-- æ–°å¢ï¼šåˆ é™¤æŒ‰é’® -->
        <button class="delete-btn" id="deleteMemoryBtn" data-memory-id="{{ memory.id }}">
            <i class="fas fa-trash"></i> åˆ é™¤çºªå¿µæ—¥
        </button>
        <div class="memory-icon">{{ memory.icon }}</div>
        <h1 class="memory-title">{{ memory.title }}</h1>
        <div class="memory-date">
            <i class="far fa-calendar"></i> {{ memory.date.strftime("%Yå¹´%mæœˆ%dæ—¥") }}
            {% if memory.is_annual %}
            <span style="background:#e8f5e8; color:#4CAF50; padding:4px 12px; border-radius:20px; font-size:0.9rem;">
                <i class="fas fa-redo"></i> æ¯å¹´é‡å¤
            </span>
            {% endif %}
        </div>
        {% if memory.description %}
        <div class="memory-description">
            <i class="fas fa-quote-left" style="color:#ff6b6b;"></i> {{ memory.description }}
        </div>
        {% endif %}
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-number">{{ stats.days_since }}</div>
            <div class="stat-label">å·²è¿‡å»å¤©æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.years_since }}</div>
            <div class="stat-label">ç¬¬ {{ stats.years_since }} ä¸ªå¹´å¤´</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.total_snapshots }}</div>
            <div class="stat-label">å¹´è½®è®°å½•</div>
        </div>
    </div>

    <!-- å¹´è½®è®°å½• -->
    <div class="snapshots-section">
        <h2 class="section-title">
            <i class="fas fa-history"></i> å¹´è½®è®°å½•
        </h2>

        {% if snapshots %}
        <div class="snapshots-list">
            {% for snapshot in snapshots %}
            <div class="snapshot-item">
                <div class="snapshot-year">
                    <i class="fas fa-calendar-alt"></i> {{ snapshot.year }} å¹´
                </div>

                {% if snapshot.weather or snapshot.mood or snapshot.location %}
                <div class="snapshot-meta">
                    {% if snapshot.weather %}
                    <div class="meta-item">
                        <i class="fas fa-cloud"></i> {{ snapshot.weather }}
                    </div>
                    {% endif %}
                    
                    {% if snapshot.mood %}
                    <div class="meta-item">
                        <i class="fas fa-smile"></i> {{ snapshot.mood }}
                    </div>
                    {% endif %}
                    
                    {% if snapshot.location %}
                    <div class="meta-item">
                        <i class="fas fa-map-marker-alt"></i> {{ snapshot.location }}
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if snapshot.note %}
                <div class="snapshot-note">
                    {{ snapshot.note }}
                </div>
                {% endif %}

                {% if snapshot.image %}
                <div class="snapshot-image">
                    <img src="{{ snapshot.image }}" 
                         alt="{{ snapshot.year }}å¹´çš„ç…§ç‰‡"
                         onclick="openImageModal('{{ snapshot.image }}')">
                </div>
                {% endif %}

                <div class="snapshot-date">
                    <i class="far fa-clock"></i> è®°å½•äº {{ snapshot.created_at.strftime("%Y-%m-%d %H:%M") }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>è¿˜æ²¡æœ‰å¹´è½®è®°å½•</h3>
            <p>ä¸ºè¿™ä¸ªçºªå¿µæ—¥æ·»åŠ ç¬¬ä¸€æ¡å¹´è½®è®°å½•å§ï¼</p>
        </div>
        {% endif %}
    </div>

    <!-- æ·»åŠ å¹´è½®è®°å½•è¡¨å• -->
    <div class="add-snapshot-form">
        <h2 class="section-title">
            <i class="fas fa-plus"></i> æ·»åŠ å¹´è½®è®°å½•
        </h2>

        <form id="addSnapshotForm" enctype="multipart/form-data">
            <input type="hidden" name="memory_id" value="{{ memory.id }}">

            <!-- å¹´ä»½ -->
            <div class="form-group">
                <label class="form-label" for="year">
                    <i class="far fa-calendar"></i> å¹´ä»½
                </label>
                <input type="number" id="year" name="year" class="form-control"
                       value="{{ today.year }}" min="2000" max="{{ today.year }}"
                       required>
            </div>

            <!-- æ„Ÿæ‚Ÿ -->
            <div class="form-group">
                <label class="form-label" for="note">
                    <i class="fas fa-comment"></i> ä»Šå¹´çš„æ„Ÿæ‚Ÿ
                </label>
                <textarea id="note" name="note" class="form-control"
                          placeholder="è®°å½•ä¸‹ä»Šå¹´å…³äºè¿™ä¸ªæ—¥å­çš„æ„Ÿå—ã€å˜åŒ–å’Œæ”¶è·..."
                          rows="4" required></textarea>
            </div>

            <!-- å›¾ç‰‡ä¸Šä¼  -->
            <div class="form-group">
                <label class="form-label" for="image">
                    <i class="fas fa-image"></i> å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
                </label>
                <input type="file" id="image" name="image" class="form-control" 
                       accept="image/*" onchange="previewImage(event)">
                <div class="image-preview" id="imagePreview"></div>
            </div>

            <!-- å…ƒä¿¡æ¯ -->
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" for="weather">
                        <i class="fas fa-cloud"></i> å¤©æ°”
                    </label>
                    <input type="text" id="weather" name="weather" class="form-control"
                           placeholder="æ™´å¤©ã€é›¨å¤©...">
                </div>

                <div class="form-group">
                    <label class="form-label" for="mood">
                        <i class="fas fa-smile"></i> å¿ƒæƒ…
                    </label>
                    <input type="text" id="mood" name="mood" class="form-control"
                           placeholder="å¼€å¿ƒã€æ„ŸåŠ¨...">
                </div>

                <div class="form-group">
                    <label class="form-label" for="location">
                        <i class="fas fa-map-marker-alt"></i> åœ°ç‚¹
                    </label>
                    <input type="text" id="location" name="location" class="form-control"
                           placeholder="åœ¨å“ªé‡Œè®°å½•çš„ï¼Ÿ">
                </div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                <i class="fas fa-save"></i> ä¿å­˜è®°å½•
            </button>
        </form>
    </div>
</div>

<!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
<div class="modal" id="imageModal" onclick="closeImageModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeImageModal()">&times;</button>
        <img id="modalImage" class="modal-image" src="" alt="">
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// å›¾ç‰‡é¢„è§ˆ
function previewImage(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('imagePreview');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.innerHTML = `
                <img src="${e.target.result}" alt="é¢„è§ˆ" 
                     style="max-width: 200px; border-radius: 8px; margin-top: 10px;">
            `;
        };
        reader.readAsDataURL(file);
    } else {
        preview.innerHTML = '';
    }
}

// æ‰“å¼€å›¾ç‰‡æ¨¡æ€æ¡†
function openImageModal(imageUrl) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    
    modalImage.src = imageUrl;
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// å…³é—­å›¾ç‰‡æ¨¡æ€æ¡†
function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// è¡¨å•æäº¤
document.getElementById('addSnapshotForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    
    // éªŒè¯
    const year = document.getElementById('year').value;
    const note = document.getElementById('note').value.trim();
    
    if (!year) {
        alert('è¯·å¡«å†™å¹´ä»½');
        return;
    }
    
    if (!note) {
        alert('è¯·å¡«å†™ä»Šå¹´çš„æ„Ÿæ‚Ÿ');
        return;
    }
    
    // ç¦ç”¨æŒ‰é’®
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ä¿å­˜ä¸­...';
    
    try {
        console.log('æäº¤è¡¨å•æ•°æ®:', {
            year: formData.get('year'),
            note: formData.get('note')
        });
        
        const response = await fetch(`/memories/${formData.get('memory_id')}/snapshot`, {
            method: 'POST',
            body: formData
        });
        
        console.log('å“åº”çŠ¶æ€ç :', response.status);
        
        if (response.ok) {
            const data = await response.json();
            console.log('ä¿å­˜æˆåŠŸ:', data);
            alert('è®°å½•ä¿å­˜æˆåŠŸï¼');

            // å»¶è¿Ÿåˆ·æ–°é¡µé¢
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
    // å°è¯•è§£æé”™è¯¯ä¿¡æ¯
    try {
        const errorData = await response.json();
        console.error('ä¿å­˜å¤±è´¥:', errorData);

        // æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯
        if (errorData.detail) {
            alert(`ä¿å­˜å¤±è´¥: ${errorData.detail}`);
        } else if (errorData.error) {
            alert(`ä¿å­˜å¤±è´¥: ${errorData.error}`);
        } else {
            alert(`ä¿å­˜å¤±è´¥: çŠ¶æ€ç  ${response.status}`);
        }
    } catch (jsonError) {
        // å¦‚æœå“åº”ä¸æ˜¯ JSONï¼Œæ˜¾ç¤ºçŠ¶æ€ç 
        console.error('å“åº”ä¸æ˜¯ JSON æ ¼å¼:', jsonError);
        alert(`ä¿å­˜å¤±è´¥: çŠ¶æ€ç  ${response.status}`);
    }

    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
}
    } catch (error) {
        console.error('ç½‘ç»œé”™è¯¯:', error);
        alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');

        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
});
// æ–°å¢ï¼šåˆ é™¤çºªå¿µæ—¥åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    const deleteBtn = document.getElementById('deleteMemoryBtn');
    const memoryId = deleteBtn?.dataset.memoryId;

    if (deleteBtn && memoryId) {
        deleteBtn.addEventListener('click', async function () {
            // 1. äºŒæ¬¡ç¡®è®¤ï¼Œé˜²æ­¢è¯¯åˆ 
            const confirmDelete = confirm('âš ï¸ ç¡®è®¤è¦åˆ é™¤è¿™ä¸ªçºªå¿µæ—¥å—ï¼Ÿåˆ é™¤åæ‰€æœ‰å¹´è½®è®°å½•ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œä¸”æ— æ³•æ¢å¤ï¼');
            if (!confirmDelete) return;

            // 2. ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ é™¤ä¸­...';

            try {
                // 3. å‘é€DELETEè¯·æ±‚åˆ°åç«¯æ¥å£
                const response = await fetch(`/memories/api/${memoryId}`, {
                    method: 'DELETE',
                    headers: {
                        // å¦‚æœåç«¯éœ€è¦è®¤è¯ï¼ˆå¦‚Cookieï¼‰ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦ï¼Œæ— éœ€é¢å¤–è®¾ç½®
                        'X-Requested-With': 'XMLHttpRequest' // æ ‡è¯†AJAXè¯·æ±‚
                    }
                });

                if (response.ok) {
                    // 4. åˆ é™¤æˆåŠŸï¼šæç¤ºå¹¶è·³è½¬åˆ°çºªå¿µæ—¥åˆ—è¡¨é¡µ
                    alert('âœ… çºªå¿µæ—¥å·²æˆåŠŸåˆ é™¤ï¼');
                    window.location.href = '/memories'; // è·³è½¬åˆ°åˆ—è¡¨é¡µ
                } else {
                    // 5. å¤„ç†åç«¯è¿”å›çš„é”™è¯¯
                    const errorData = await response.json().catch(() => ({detail: 'åˆ é™¤å¤±è´¥'}));
                    alert(`âŒ åˆ é™¤å¤±è´¥ï¼š${errorData.detail || 'æœªçŸ¥é”™è¯¯'}`);
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    deleteBtn.disabled = false;
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i> åˆ é™¤çºªå¿µæ—¥';
                }
            } catch (error) {
                // 6. å¤„ç†ç½‘ç»œé”™è¯¯
                console.error('åˆ é™¤è¯·æ±‚å¤±è´¥:', error);
                alert('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•ï¼');
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> åˆ é™¤çºªå¿µæ—¥';
            }
        });
    }
});
// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // æ·»åŠ æ¨¡æ€æ¡†æ ·å¼
    const modalStyle = document.createElement('style');
    modalStyle.textContent = `
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
        }
    `;
    document.head.appendChild(modalStyle);
    
    // ç›‘å¬ ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeImageModal();
        }
    });
});
</script>
{% endblock %}